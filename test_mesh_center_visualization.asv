addpath(genpath('external'));
addpath 'functions';

mesh = load('mesh/neutral.mat');
mesh = mesh.mesh;

transforms = cell(1, 18);
for i = 1 : 18
    transforms{i} = eye(4);
end
axes = bone_axes(mesh.spheres);

centers = zeros(30,3);
for i = 1:30;
centers(i,:) = mesh.spheres{1,i}.center;
end 
C = centers;
root = centers(26, :) * 0.5 + centers(27, :) * 0.5;

itpts = [20; 19; 17; 16]; %interest point index of center 
% n_thumb = 20, 19, 17, 16

B = C(itpts,:); %interest point of axes

%% visualization of axis  
axes_3 = axes{1,3};
axes_3 = axes_3(1:3,1:3) + axes_3(1:3,4);
figure(1)
hold on
scatter3(axes_3(1,1),axes_3(2,1),axes_3(3,1),'.', 'MarkerEdgeColor',[255/255, 0, 0]) % x-axis, colored red
scatter3(axes_3(1,2),axes_3(2,2),axes_3(3,2),'.', 'MarkerEdgeColor',[0, 255/255, 0]) % y-axis, colored green
scatter3(axes_3(1,3),axes_3(2,3),axes_3(3,3),'.', 'MarkerEdgeColor',[0, 0, 255/255]) % z-axis, colored blue
scatter3(axes_3(1,4),axes_3(2,4),axes_3(3,4),'.', 'MarkerEdgeColor',[0, 0, 0]) % center, colored black
%scatter3(0,0,0,'.','MarkerEdgeColor',[0, 255/255, 222/255]) % origin(0,0,0), colored cyan
plot3(axes_3(1:2,1),axes_3(1:2,2),axes_3(1:2,3),'-r')
h = trimesh(mesh.faces, mesh.vertices(:, 1), mesh.vertices(:, 2), mesh.vertices(:, 3), 'EdgeColor', 'none', 'FaceColor', [0.8, 0.8, 0.8], 'FaceAlpha', 0.5);
view([-90, 0]);
camlight;
view([90, 0]);
camlight;
axis equal;
grid off;
lighting gouraud;
axis off;
hold off



%% Render mesh
hold on
h = trimesh(mesh.faces, mesh.vertices(:, 1), mesh.vertices(:, 2), mesh.vertices(:, 3), 'EdgeColor', 'none', 'FaceColor', [0.8, 0.8, 0.8], 'FaceAlpha', 0.5);
view([-90, 0]);
camlight;
view([90, 0]);
camlight;
axis equal;
grid off;
lighting gouraud;
axis off;
% scatter3(C(:,1), C(:,2), C(:,3),'.', 'MarkerEdgeColor',[0, 0, 0]);
scatter3(B(:,1), B(:,2), B(:,3),'.', 'MarkerEdgeColor',[0, 0, 0]);
plot3(n_thumb(1:2,1), n_thumb(1:2,2), n_thumb(1:2,3), '-k')

hold off